<?xml version='1.0' encoding='UTF-8'?>
<page xmlns="http://n2oapp.net/framework/config/schema/page-3.0"
      name="Создание уведомления">
    <regions>
        <form id="create" query-id="messaging_message">
            <fields>
                <set>
                    <row>
                        <input-select id="template" label="Шаблон" query-id="messaging_msg_template"
                                      search-field-id="name"
                                      label-field-id="name"/>
                    </row>
                    <input-select id="infoType" label="Информирование" required="true"
                                  query-id="messaging_channels">
                        <dependencies>
                            <set-value on="template">if (typeof template != 'undefined' &amp;&amp; template) return
                                template.infoType;
                            </set-value>
                        </dependencies>
                    </input-select>
                    <row>
                    </row>
                    <row>
                        <select id="severity" label="Уровень важности">
                            <options>
                                <option id="SEVERE" name="Важный"/>
                                <option id="ERROR" name="Ошибка"/>
                                <option id="WARNING" name="Предупреждение"/>
                                <option id="INFO" name="Информация"/>
                            </options>
                            <dependencies>
                                <set-value on="template">if (typeof template != 'undefined' &amp;&amp; template) return
                                    template.severity;
                                </set-value>
                                <visibility on="infoType">'${novus.messaging.web-channel-id}' === infoType.id
                                </visibility>
                                <requiring on="infoType">'${novus.messaging.web-channel-id}' === infoType.id</requiring>
                            </dependencies>
                        </select>
                        <select id="alertType" label="Способ отображения">
                            <options>
                                <option id="BLOCKER" name="Блокирующее уведомление"/>
                                <option id="POPUP" name="Всплывающее уведомление"/>
                                <option id="HIDDEN" name="Лента уведомлений"/>
                            </options>
                            <dependencies>
                                <set-value on="template">if (typeof template != 'undefined' &amp;&amp; template) return
                                    template.alertType;
                                </set-value>
                                <visibility on="infoType">'${novus.messaging.web-channel-id}' === infoType.id
                                </visibility>
                                <requiring on="infoType">'${novus.messaging.web-channel-id}' === infoType.id</requiring>
                            </dependencies>
                        </select>
                    </row>
                    <row>
                        <text-area id="caption" label="Заголовок уведомления" max-rows="3" required="true">
                            <dependencies>
                                <set-value on="template">if (typeof template != 'undefined' &amp;&amp; template) return
                                    template.caption;
                                </set-value>
                            </dependencies>
                        </text-area>
                    </row>
                    <row>
                        <text-area id="text" label="Текст уведомления" max-rows="5" required="true">
                            <dependencies>
                                <set-value on="template">if (typeof template != 'undefined' &amp;&amp; template) return
                                    template.text;
                                </set-value>
                            </dependencies>
                        </text-area>
                    </row>
                    <row>
                        <radio-group id="recipientType" label="Тип получателей" inline="true" required="true">
                            <default-value id="RECIPIENT" name="Пользователи"/>
                            <options>
                                <option id="RECIPIENT" name="Пользователи"/>
                                <option id="USER_GROUP_BY_ROLE" name="Роль"/>
                                <option id="USER_GROUP_BY_REGION" name="Регион"/>
                                <option id="USER_GROUP_BY_ORGANIZATION" name="Мед.организация"/>
                                <option id="ALL" name="Все"/>
                            </options>
                        </radio-group>
                    </row>
                    <row>
                        <input-select id="roles" type="checkboxes" label="Укажите роль"
                                      query-id="messaging_role" label-field-id="name" search-field-id="name">
                            <dependencies>
                                <requiring on="recipientType">
                                    recipientType.id == 'USER_GROUP_BY_ROLE'
                                </requiring>
                                <visibility on="recipientType">
                                    recipientType.id == 'USER_GROUP_BY_ROLE'
                                </visibility>
                                <reset on="recipientType">return true;</reset>
                            </dependencies>
                        </input-select>
                        <input-select id="region" type="single" label="Укажите регион"
                                      query-id="messaging_region" label-field-id="name" search-field-id="name">
                            <dependencies>
                                <requiring on="recipientType">
                                    recipientType.id == 'USER_GROUP_BY_REGION'
                                </requiring>
                                <visibility on="recipientType">
                                    recipientType.id == 'USER_GROUP_BY_REGION'
                                </visibility>
                                <reset on="recipientType">return true;</reset>
                            </dependencies>
                        </input-select>
                        <input-select id="organizations" type="checkboxes" label="Укажите организацию"
                                      query-id="messaging_organization" label-field-id="shortName"
                                      search-field-id="shortName">
                            <dependencies>
                                <requiring on="recipientType">
                                    recipientType.id == 'USER_GROUP_BY_ORGANIZATION'
                                </requiring>
                                <visibility on="recipientType">
                                    recipientType.id == 'USER_GROUP_BY_ORGANIZATION'
                                </visibility>
                                <reset on="recipientType">return true;</reset>
                            </dependencies>
                        </input-select>
                    </row>
                </set>
            </fields>
        </form>
        <table id="recipients" selection="checkbox" query-id="messaging_recipient" object-id="messaging_message" depends-on="create"
               fetch-on-init="true">
            <pre-filters>
                <in field-id="roleCodes" values="{roles*.name}"/>
                <eq field-id="regionId" value="{region.id}"/>
                <in field-id="organizations" values="{organizations*.code}" />
            </pre-filters>
            <columns>
                <column text-field-id="name" label="Пользователь"/>
            </columns>
        </table>
    </regions>
</page>
        <!--            <row>-->
        <!--                <radio-group id="allRecipients" label="Получатели" inline="true">-->
        <!--                    <options>-->
        <!--                        <option id="2" name="Все"/>-->
        <!--                        <option id="1" name="Пользователи"/>-->
        <!--                    </options>-->
        <!--                    <default-value id="1" name="Получатели"/>-->
        <!--                </radio-group>-->
        <!--            </row>-->
        <!--            <row>-->
        <!--                <input-select id="users" type="checkboxes" label="Получатели"-->
        <!--                              query-id="messaging_recipient" label-field-id="name" search-field-id="name">-->
        <!--                    <dependencies>-->
        <!--                        <requiring on="allRecipients">-->
        <!--                            allRecipients.id == 1-->
        <!--                        </requiring>-->
        <!--                        <visibility on="recipientType, allRecipients">-->
        <!--                            (recipientType.id == 'RECIPIENT' &amp;&amp; allRecipients.id == 1)-->
        <!--                        </visibility>-->
        <!--                        <reset on="allRecipients">true</reset>-->
        <!--                    </dependencies>-->
        <!--                </input-select>-->
        <!--            </row>-->
